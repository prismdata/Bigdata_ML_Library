package org.ankus.mapreduce.algorithms.utils.GraphAnalysis;

import java.io.IOException;
import org.ankus.util.ArgumentsConstants;
import org.apache.hadoop.conf.Configuration;
import org.apache.hadoop.io.Text;
import org.apache.hadoop.mapreduce.Mapper;


public class GraphLoad_Mapper  extends Mapper<Object, Text, Text, Text>{
	String m_delimiter;
   
    @Override
    protected void setup(Context context) throws IOException, InterruptedException
    {
    	Configuration conf = context.getConfiguration();
    	m_delimiter = conf.get(ArgumentsConstants.DELIMITER, "\t");
    }
    
	@Override

	protected void map(Object key, Text value, Context context)// throws IOException, InterruptedException
	{
		if(value.toString().trim().length() > 0)
		{
			
			String[] edge = value.toString().split(m_delimiter);
			
			try
			{
				String[] endnodes =edge[1].split(";");
				if(endnodes.length > 1)
				{
					for(int ei = 0; ei < endnodes.length; ei++ )
					{
						System.out.println("Mapper:"+edge[0] +":"+ endnodes[ei]);
						context.write(new Text(edge[0]), new Text(endnodes[ei])); //adjecent nodes
					}
				}
				else
				{
					context.write(new Text(edge[0]), new Text(edge[1])); //deal with one eage
				}
				
			}
			catch (Exception e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
		}
	
	}
	
	@Override
    protected void cleanup(Context context) throws IOException, InterruptedException
    {
    	System.out.println("cleanup");
    }
}
